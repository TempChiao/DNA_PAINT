path= newArray(81);

path[0]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/10nMAptamer/pos_0/"

path[1]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/10nMAptamer/pos_1/"

path[2]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/10nMAptamer/pos_2/"

path[3]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMAptamer/pos_0/"

path[4]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMAptamer/pos_1/"

path[5]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMAptamer/pos_2/"

path[6]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMAptamer-1/pos_0/"

path[7]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMAptamer-1/pos_1/"

path[8]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMAptamer-1/pos_2/"

path[9]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMnAptamer/pos_0/"

path[10]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMnAptamer/pos_1/"

path[11]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMnAptamer/pos_2/"

path[12]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMnAptamer-1/pos_0/"

path[13]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMnAptamer-1/pos_1/"

path[14]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMnAptamer-1/pos_2/"

path[15]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMnAptamer-2/pos_0/"

path[16]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMnAptamer-2/pos_1/"

path[17]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/1nMnAptamer-2/pos_2/"

path[18]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/Blank/pos_0/"

path[19]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/Blank/pos_1/"

path[20]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/Blank/pos_2/"

path[21]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/Blank-1/pos_0/"

path[22]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/Blank-1/pos_1/"

path[23]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/Blank-1/pos_2/"

path[24]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/Blank-2/pos_0/"

path[25]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/Blank-2/pos_1/"

path[26]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/Blank-2/pos_2/"

path[27]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellA_CSF_only/pos_0/"

path[28]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellA_CSF_only/pos_1/"

path[29]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellA_CSF_only/pos_2/"

path[30]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellA_CSF_only-1/pos_0/"

path[31]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellA_CSF_only-1/pos_1/"

path[32]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellA_CSF_only-1/pos_2/"

path[33]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellA_CSF_only-2/pos_0/"

path[34]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellA_CSF_only-2/pos_1/"

path[35]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellA_CSF_only-2/pos_2/"

path[36]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellB_CSF_aptamer/pos_0/"

path[37]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellB_CSF_aptamer/pos_1/"

path[38]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellB_CSF_aptamer/pos_2/"

path[39]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellB_CSF_aptamer-1/pos_0/"

path[40]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellB_CSF_aptamer-1/pos_1/"

path[41]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellB_CSF_aptamer-1/pos_2/"

path[42]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellB_CSF_aptamer-2/pos_0/"

path[43]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellB_CSF_aptamer-2/pos_1/"

path[44]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellB_CSF_aptamer-2/pos_2/"

path[45]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellC_CSF_naptamer/pos_0/"

path[46]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellC_CSF_naptamer/pos_1/"

path[47]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellC_CSF_naptamer/pos_2/"

path[48]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellC_CSF_naptamer-1/pos_0/"

path[49]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellC_CSF_naptamer-1/pos_1/"

path[50]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellC_CSF_naptamer-1/pos_2/"

path[51]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellC_CSF_naptamer-3/pos_0/"

path[52]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellC_CSF_naptamer-3/pos_1/"

path[53]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellC_CSF_naptamer-3/pos_2/"

path[54]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellD_CSF2_Only/pos_0/"

path[55]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellD_CSF2_Only/pos_1/"

path[56]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellD_CSF2_Only/pos_2/"

path[57]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellD_CSF2_Only-1/pos_0/"

path[58]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellD_CSF2_Only-1/pos_1/"

path[59]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellD_CSF2_Only-1/pos_2/"

path[60]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellD_CSF2_Only-2/pos_0/"

path[61]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellD_CSF2_Only-2/pos_1/"

path[62]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellD_CSF2_Only-2/pos_2/"

path[63]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellE_CSF2_Aptamer/pos_0/"

path[64]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellE_CSF2_Aptamer/pos_1/"

path[65]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellE_CSF2_Aptamer/pos_2/"

path[66]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellE_CSF2_Aptamer-1/pos_0/"

path[67]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellE_CSF2_Aptamer-1/pos_1/"

path[68]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellE_CSF2_Aptamer-1/pos_2/"

path[69]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellE_CSF2_Aptamer-2/pos_0/"

path[70]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellE_CSF2_Aptamer-2/pos_1/"

path[71]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellE_CSF2_Aptamer-2/pos_2/"

path[72]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellF_CSF2_nAptamer/pos_0/"

path[73]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellF_CSF2_nAptamer/pos_1/"

path[74]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellF_CSF2_nAptamer/pos_2/"

path[75]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellF_CSF2_nAptamer-1/pos_0/"

path[76]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellF_CSF2_nAptamer-1/pos_1/"

path[77]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellF_CSF2_nAptamer-1/pos_2/"

path[78]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellF_CSF2_nAptamer-2/pos_0/"

path[79]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellF_CSF2_nAptamer-2/pos_1/"

path[80]="/Volumes/Tianxiao/20231027_Tx_TDP_CSF/WellF_CSF2_nAptamer-2/pos_2/"

for (i=0; i<path.length; i++){
k=0;
count = 0;	
n=0;
dir=path[i];
processFiles(dir);
makeRectangle(0, 0, 428, 684);
run("Crop");
run("Duplicate...", "duplicate range=1-1000");
run("Peak Fit", "template=[None] config_file=/Users/tempchiao/gdsc.smlm.settings.xml calibration=117 gain=2.17 exposure_time=50 initial_stddev0=1.000 initial_stddev1=1.000 initial_angle=0.000 spot_filter_type=Single spot_filter=Mean smoothing=1.20 search_width=1 border=1 fitting_width=3 fit_solver=[Least Squares Estimator (LSE)] fit_function=Circular fail_limit=3 neighbour_height=0.30 residuals_threshold=1 duplicate_distance=0.50 shift_factor=1 signal_strength=0 min_photons=30 min_width_factor=0.50 width_factor=2 precision=40 results_table=Uncalibrated image=[Localisations (width=precision)] image_precision=5 image_scale=8 results_dir=[] results_in_memory camera_bias=0 fit_criteria=[Least-squared error] significant_digits=5 coord_delta=0.0001 lambda=10.0000 max_iterations=20 stack");

saveAs("Tiff", ""+dir+"SuperRes.tif");
close();
close();
close();
		
selectWindow("Fit Results");
saveAs("text",dir+"FitResults.txt");
	
run("Close");

}


/////////// Function to process the files ///////////////

function processFiles(dir) 

	{

	list = getFileList(dir);

		for (i=0; i<list.length; i++)

		 {

		if (!startsWith(list[i],"Log"))

			{

			if (endsWith(list[i], "/"))

		              processFiles(""+dir+list[i]);

         			 else 

			{

		             showProgress(n++, count);

            			path = dir+list[i];

	            		processFile(path);

			}

			}

		}

	}

function processFile(path) 

	{
		       	if (endsWith(path, "posZ0.tif") || endsWith(path, "561_1.tif") ) 
 
		{
			open(path);

			//run("TIFF Virtual Stack...", "open=["+path+"]");

		
	k++;
 			
//run("Close"); 

		}
	}